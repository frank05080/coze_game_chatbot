# 1. 项目介绍



为了迎接2025年1024程序员节，地瓜机器人 × 扣子联合发起「Vibe Coze Hackathon 2025」——以“机器人+扣子”做端云一体化 ，借助扣子传播优势，联动优质高校、AI 社区、B站、抖音、小红书等平台的头部媒体以及KOL ，推动地瓜机器人在 AI 领域以及泛互联网的品牌影响力和市场认可度，打造“端云一体化+多模型串联”的技术形象。本次活动日期为2025年10月24日-11月30日。



本次黑客松目标为吸纳优秀开发者的创意作品，本项目为引导开发者开发的示例项目。本项目实现了一个“端云协同”的聊天游戏机器人 Demo，其中**云端**负责运行大型语言模型（LLM），处理自然语言理解与对话生成，提供丰富的聊天能力。本地（边缘设备：RDK X5）则运行部署在BPU上的强化学习模型（DQN），在本地环境上部署并实时运行一个小游戏（MountainCar 环境的变体），实现低延迟的交互控制和即时反馈。



目标是把“陪伴式聊天”与“交互小游戏”结合起来：用户可以与机器人进行日常聊天，同时触发并参与一个简单的强化学习小游戏，获得即时视觉/语音反馈与互动体验。灵感来自日本 MakerFaire Tokyo 上的 Cocomo 陪伴机器人——不仅聊天，还能做任务、跟随、陪玩。



# 2. 特色亮点

本案例为本次黑客松提供了一个标准的模板，和云边端模型结合的思路，包括的特色和亮点如下：

1. **端云协同架构**：云端负责语言理解与复杂生成，本地负责实时控制与 RL 推理，达到“既强大又低延迟”的体验平衡。

2. **在 RDK X5 上部署 DQN**：把训练好的 DQN 模型导出并部署到边缘硬件（RDK X5），在真实或模拟的 MountainCar 环境上运行，作为小游戏内核。

3. **聊天与游戏的无缝融合**：聊天过程中机器人可以发起小游戏邀请、解释游戏状况、给出鼓励或策略提示，使对话更富互动性与趣味性。

4. **轻量化部署与实时交互**：本地推理与环境运行保证了对用户输入（按键、触屏、语音指令）的低延迟响应，改进用户体验。

5. **可拓展的交互模式**：除 MountainCar，可扩展到更多小型 RL 环境或体感交互（如简单跟随、避障小游戏等）。



# 3. 技术细节

## 3.1 系统架构

具体而言，系统架构可以分为：

1. **云端 LLM 服务**：负责对话理解、生成、策略提示语句、游戏规则解释、非实时策略推荐等。

2. **本地代理（RDK X5）**：接收云端指令 & 本地用户输入，运行 DQN 推理以控制 MountainCar 环境，并把环境状态/奖励回传给前端与云端（用于展示与日志）。

3. **通信**：采用轻量协议（如 WebSocket/HTTP REST），消息包含对话上下文、游戏状态、控制命令、模型日志等。

![](images/image-4.png)

## 3.2 板端模型部署

我们将DQN模型通过工具链进行转换和部署。

其中，工具链的版本我们选择：

hbdk version 3.49.9

horizon\_nn version 1.1.0

hb\_mapper version 1.24.3

将训练好的模型进行转换后，得到如下结果和精度：

![](images/image-3.png)

可以看到模型输出基本与原始模型保持一致，均超过0.9999

对于该DQN小模型的部署效率，我们使用如下的命令。

我们首先就RDK X5进行超频：

```bash
# 8核心CPU全核心1.8GHz，Performance调度
sudo bash -c "echo 1 > /sys/devices/system/cpu/cpufreq/boost"
sudo bash -c "echo performance > /sys/devices/system/cpu/cpufreq/policy0/scaling_governor"
# BPU超频到1.2GHz
echo 1200000000 > /sys/kernel/debug/clk/bpu_mclk_2x_clk/clk_rate
```

我们随后使用如下命令进行测试

```plain&#x20;text
hrt_model_exec perf --model_file car_dqn_output.bin --frame_count 100 --thread_num 1
```

其中，frame\_count参数表示我们选取多少帧进行测试，我们保持100帧进行测试。而thread\_num参数则表示选取多少个线程进行测试，我们就更改这个参数得到如下表格：

| 线程数 | 总帧数 | 总时延（ms） | 平均时延（ms） | FPS     |
| --- | --- | ------- | -------- | ------- |
| 1   | 100 | 34.15   | 0.34     | 2850.22 |
| 2   | 100 | 40.22   | 0.40     | 4736.42 |
| 4   | 100 | 48.41   | 0.48     | 7607.45 |
| 8   | 100 | 80.16   | 0.80     | 8452.37 |

量化后的精度以小车能否成功爬山为基准，能在X5上成功完成任务则算成功。结果为X5部署成功

对于其他指标，我们查看其带宽和bpu利用率。

BPU利用率我们使用:

```plain&#x20;text
hrut_somstatus
```

进行查看，得到如下:

![](images/image.png)

BPU利用率为：9%

对于带宽，我们使用命令：

```plain&#x20;text
hrut_ddr -p 1000 -t all
```

得到如下

![](images/image-1.png)

带宽读写均在BPU上，且占用较小

## 3.3 运行流程

该项目运行较为简单，我们首先确保RDK X5有正确连网，随后我们打开MobaXTerm，进入项目目录。

安装相关依赖：

```plain&#x20;text
pip install -r requirements.txt
```

```plain&#x20;text
pip install bpu_infer_lib_x3-1.0.3-py3-none-any.whl
```

完成依赖安装后，我们需要将扣子的API TOKEN、BOT\_ID和USER\_ID在代码中进行填写

![](images/image-2.png)



完成填写后，我们在MobaXTerm中运行即可进行对话：

```plain&#x20;text
python play_with_coze.py
```

当触发game关键词时，进入强化学习小游戏。

当输入\`exit\`时，则退出程序。
